<!DOCTYPE html>
<html lang="en">

<head>
    <!--This is necessary to avoid "http://localhost:8000/favicon.ico [HTTP/1.1 404 Not Found 0ms]" error-->
    <link rel="shortcut icon" href="#"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="support/css/main.css">
    <link rel="stylesheet" href="support/css/analytics.css">
    <script src="support/js/jquery.js"></script>
    <script src="support/js/main.js"></script>
    <script src="support/js/analytics.js"></script>
    <title>Money Buddy</title>
</head>

<body>
    <div id="includedheader"></div>

    <main>
        <h2 id="title">Expense Analytics</h2>

        <!--pie chart-->
        <div class="pie-chart"></div>
        
        <!--Bar Chart-->
        <div class="barchart-container">
            <!--totals-->
            <div class="stats">
                <p><b>Total Income: </b><span id="totalInc"></span>$</p>
                <p><b>Total Spent: </b><span id="totalSpent"></span>$</p>
                <p><i>You could buy <b><span id="bananamath"></span></b> bananas for that amount of money!</i></p>
                <span id="info_hover"><b>why?</b></span>
                <span id="hidden_info"><i>if 1 banana = 0.5$</i></span>
            </div>
            
            <button onclick="toggleVisibility()" id="tglbtn"><b>Bar Chart âŒ„</b></button>
            <div class="barchart hidden" id="hiddenText">
                <p>barchart will appear here</p>
            </div>
        
        <div id="legend"> 
            <h3 id="ch3">Pie Chart Legend</h3>
            <p><span id="name0"> </span>: <span id="amount0"></span>$</p>
            <p><span id="name1"> </span>: <span id="amount1"></span>$</p>
            <p><span id="name2"> </span>: <span id="amount2"></span>$</p>
            <p><span id="name3"> </span>: <span id="amount3"></span>$</p>
            <p><span id="other">Other: </span> <span id="amountother"></span>$</p>
        </div>
    </main>

    <div id="includedfooter"></div>
    <script>
        xhr = new XMLHttpRequest();
        xhr.open('GET', 'http://localhost:8000/getuserdata', true);
        xhr.onload = function() {
            if (this.status == 200) {
                var u = JSON.parse(this.responseText);
                u.Analytics.Income == null ? document.getElementById("totalInc").innerHTML = 0 : document.getElementById("totalInc").innerHTML = u.Analytics.Income;
                u.Analytics.Expenditure == null ? document.getElementById("totalSpent").innerHTML = 0 : document.getElementById("totalSpent").innerHTML = u.Analytics.Expenditure;
                for (let i = 0; i < 4; i++) {
                    document.getElementById("name"+i).innerHTML = u.Analytics.Categories[i].Name;
                    u.Analytics.Categories[i].Amount == null ? document.getElementById("amount"+i).innerHTML = 0 : document.getElementById("amount"+i).innerHTML = u.Analytics.Categories[i].Amount;
                }
                u.Analytics.Categories[4].Amount == null ? document.getElementById("amountother").innerHTML = 0 : document.getElementById("amountother").innerHTML = u.Analytics.Categories[4].Amount;
            }
        }
        xhr.send();
    </script>
</body>
</html>